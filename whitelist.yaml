# whitelist.yaml
version: 1
default_timeout_seconds: 300

tools:
  nmap:
    description: "Network scanner for reconnaissance (read-only)"
    params:
      - name: target
        type: ip
        required: true
      - name: flags
        type: enum
        allowed:
          - "-sV"
          - "-sS"
          - "-A"
          - "-sP"
        required: false
      - name: ports
        type: ports
        required: false
    template: "nmap {flags} {ports} {target}"
    requires_approval: false
    notes: "Use for reconnaissance; safe."

  ping:
    description: "ICMP reachability check"
    params:
      - name: target
        type: ip
        required: true
      - name: count
        type: int
        min: 1
        max: 5
        required: false
    template: "ping -c {count} {target}"
    requires_approval: false

  tcpdump:
    description: "Packet capture (read-only). Saves to /tmp on target."
    params:
      - name: interface
        type: iface
        allowed:
          - "eth1"
          - "enp0s8"
          - "eth0"
        required: true
      - name: duration
        type: int
        min: 1
        max: 300
        required: false
    template: "timeout {duration} tcpdump -i {interface} -c 200 -w /tmp/{interface}_capture.pcap"
    requires_approval: false
    notes: "Controller must retrieve pcap and delete it after analysis."

  iptables:
    description: "Host firewall changes (defensive)."
    params:
      - name: chain
        type: enum
        allowed:
          - "INPUT"
          - "OUTPUT"
          - "FORWARD"
        required: true
      - name: src
        type: ip
        required: true
      - name: action
        type: enum
        allowed:
          - "DROP"
          - "REJECT"
        required: true
    template: "sudo iptables -A {chain} -s {src} -j {action}"
    requires_approval: true
    notes: "Requires snapshot and manual approval."

  hydra:
    description: "Password brute force (requires manual approval)."
    params:
      - name: target
        type: ip
        required: true
      - name: username
        type: alnum
        required: true
      - name: wordlist
        type: existing_path
        allowed_paths:
          - "/usr/share/wordlists/rockyou.txt"
          - "/home/controller/wordlists/small.txt"
        required: true
      - name: max_attempts
        type: int
        min: 1
        max: 1000
        required: false
    template: "hydra -l {username} -P {wordlist} -t 4 -V ssh://{target}"
    requires_approval: true
    notes: "Snapshot MUST be taken manually before approval. Rate-limit enforcement required."

  sudo_harden:
    description: "Remove or restrict sudo privileges from a user (defensive)."
    params:
      - name: target
        type: ip
        required: true
      - name: user
        type: alnum
        required: true
      - name: action
        type: enum
        allowed:
          - "remove_sudo"
        required: true
    template: "sudo deluser {user} sudo"
    requires_approval: true
    notes: "Powerful defensive action. Always require manual approval and snapshot before execution."

  simulator:
    description: "Simulation-only: outputs completion messages; no real actions."
    params:
      - name: target
        type: ip
        required: true
      - name: filename
        type: string
        required: false
      - name: port
        type: int
        required: false
      - name: account
        type: alnum
        required: false
      - name: user
        type: alnum
        required: false
      - name: action
        type: string
        required: false
      - name: result
        type: enum
        allowed: ["success","partial","failure","root","sudo","admin","user","guest","none","unknown"]
        required: true
      - name: message
        type: string
        required: true
    template: "echo SIMULATION: {result} - {message}"
    requires_approval: false
    notes: "Outputs a message only. No destructive commands."

# helper param types (informational)
_param_types:
  ip: "IPv4 dotted quad only"
  ports: "comma separated ports or ranges, e.g., 22,80 or 1-1024"
  iface: "interface literal allowed above"
  existing_path: "explicitly allowed paths only"
  alnum: "alphanumeric (usernames/labels)"
